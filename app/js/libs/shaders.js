function get_browser(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===i[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),{name:i[0],version:i[1]})}var browser=get_browser();if(("Chrome"===browser.name&&browser.version>63||"Firefox"===browser.name&&browser.version>57||"Safari"===browser.name&&browser.version>9)&&document.documentElement.clientWidth>1024){class e{constructor({images:e=[],texts:t=[]}={}){this.canvas=null,this.engine=null,this.scene=null,this.camera=null,this.images=e,this.activeImageIndex=0,this.planesImg=new Array(this.images.length),this.planesImgBounds=new Array(this.images.length),this.texts=t,this.planesTexts=new Array(this.texts.length),this.planesTextsBounds=new Array(this.texts.length),this.fisheyePP=null,this.fisheyeDistortion={value:0},this.debug=!1,this.animateInDispFactorCallback=(e=>this.animateInDispFactor(e)),this.animateOutDispFactorCallback=(()=>this.animateOutDispFactor())}init(){this.setup(),this.setElementsBounds(),this.createElements(),this.setElementsStyle(),this.addListeners(),this.setFisheye()}setup(){this.canvas=document.querySelector("#app"),this.engine=new BABYLON.Engine(this.canvas,!0,null,!0),this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=BABYLON.Color3.Black();new BABYLON.HemisphericLight("HemisphericLight",new BABYLON.Vector3(1,1,0),this.scene);this.camera=new BABYLON.ArcRotateCamera("Camera",-Math.PI/2,Math.PI/2,10,BABYLON.Vector3.Zero(),this.scene),this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA,this.engine.runRenderLoop(()=>this.scene.render())}createElements(){BABYLON.Effect.ShadersStore.imagesVertexShader="\n       precision highp float;\n  \n       // Attributes\n       attribute vec3 position;\n       attribute vec3 normal;\n       attribute vec2 uv;\n  \n       // Uniforms\n       uniform mat4 worldViewProjection;\n  \n       // Varying\n       varying vec2 vUV;\n  \n       void main(void) {\n           vec3 pos = position;\n           gl_Position = worldViewProjection * vec4(pos, 1.0);\n  \n           vUV = uv;\n       }\n      ",BABYLON.Effect.ShadersStore.imagesFragmentShader="\n       precision highp float;\n  \n       uniform sampler2D u_mainTexture;\n       uniform sampler2D u_secondaryTexture;\n       uniform sampler2D u_displacementTexture;\n  \n       uniform float dispFactor;\n       uniform float effectFactor;\n  \n       varying vec2 vUV;\n  \n       void main() {\n         vec2 uv = vUV;\n  \n         vec4 disp = texture2D(u_displacementTexture, uv);\n  \n         vec2 distortedPosition = vec2(uv.x + dispFactor * (disp.r * effectFactor), uv.y);\n         vec2 distortedPosition2 = vec2(uv.x - (1.0 - dispFactor) * (disp.r * effectFactor), uv.y);\n  \n         vec4 _texture = texture2D(u_mainTexture, distortedPosition);\n         vec4 _texture2 = texture2D(u_secondaryTexture, distortedPosition2);\n  \n         vec4 finalTexture = mix(_texture, _texture2, dispFactor);\n  \n         gl_FragColor = finalTexture;\n       }\n      ";const e=new BABYLON.Texture("../img/displacement.jpg",this.scene,!0),t=new BABYLON.ShaderMaterial("DisplacementMaterial",this.scene,{vertex:"images",fragment:"images",attributes:["position","normal","uv"],uniforms:["worldViewProjection"]}),i=new BABYLON.PlaneBuilder.CreatePlane("BaseMesh",{},this.scene),s=this.images.length;for(let n=0;n<s;n++){this.images[n].classList.add("js-webgl-element-hidden"),this.planesImg[n]=i.clone(`Image${n.toString().padStart(1,"0")}`),this.planesImg[n].material=t.clone(`Image0${n}Material`),this.planesImg[n].doNotSyncBoundingInfo=!0;const s=new BABYLON.Texture(this.images[n].src.replace(window.location.href,""),this.scene,!0),a=new BABYLON.Texture(this.images[n].src.replace(window.location.href,""),this.scene,!0);this.planesImg[n].material.setTexture("u_mainTexture",s),this.planesImg[n].material.setTexture("u_secondaryTexture",a),this.planesImg[n].material.setTexture("u_displacementTexture",e),this.planesImg[n].material.setFloat("dispFactor",0),this.planesImg[n].material.setFloat("effectFactor",.5)}}setElementsBounds(){let e=this.images.length;for(let t=0;t<e;t++){const e=this.images[t].getBoundingClientRect();this.planesImgBounds[t]={x:e.x,y:e.y+(window.scrollY||window.pageYOffset),width:e.width,height:e.height}}}setElementsStyle(){let e=this.images.length;for(let t=0;t<e;t++)this.planesImg[t].scaling.x=this.images[t].clientWidth,this.planesImg[t].scaling.y=this.images[t].clientHeight;e=this.texts.length;for(let t=0;t<e;t++)this.setTextStyle({plane:this.planesTexts[t],index:t})}setElementsPosition(){let e=this.images.length;for(let t=0;t<e;t++)this.planesImg[t].position.y=-this.planesImgBounds[t].height/2+this.canvas.clientHeight/2-this.planesImgBounds[t].y+(window.scrollY||window.pageYOffset),this.planesImg[t].position.x=this.planesImgBounds[t].width/2-this.canvas.clientWidth/2+this.planesImgBounds[t].x}setTextStyle({plane:e,index:t}){const i=getComputedStyle(this.texts[t]);switch(e.fontSize=i.fontSize,e.fontFamily=i.fontFamily,e.fontWeight=i.fontWeight,e.resizeToFit=!0,e.textWrapping=!0,e.widthInPixels=this.texts[t].clientWidth,e.heightInPixels=this.texts[t].clientHeight,i.textAlign){case"left":case"start":e.textHorizontalAlignment=BABYLON.GUI.TextBlock.HORIZONTAL_ALIGNMENT_LEFT,e.leftInPixels=this.texts[t].clientWidth/2;break;case"right":e.textHorizontalAlignment=BABYLON.GUI.TextBlock.HORIZONTAL_ALIGNMENT_RIGHT,e.rightInPixels=-this.texts[t].clientWidth/2;break;case"center":e.textHorizontalAlignment=BABYLON.GUI.TextBlock._HORIZONTAL_ALIGNMENT_CENTER}}animateDispFactor({target:e,to:t}){const i={value:e.material._floats.dispFactor};TweenMax.fromTo(i,.6,{value:e.material._floats.dispFactor},{value:t,onUpdate:()=>{e.material.setFloat("dispFactor",i.value)}})}animateInDispFactor(e){this.activeImageIndex=this.images.indexOf(e.target),this.animateDispFactor({target:this.planesImg[this.activeImageIndex],to:1})}animateOutDispFactor(){this.animateDispFactor({target:this.planesImg[this.activeImageIndex],to:0})}animateFisheye({value:e}){TweenMax.to(this.fisheyeDistortion,.3,{value:.007*e})}addListeners(){const e=this.images.length;for(let t=0;t<e;t++)this.images[t].addEventListener("pointerenter",this.animateInDispFactorCallback,{passive:!0}),this.images[t].addEventListener("pointerleave",this.animateOutDispFactorCallback,{passive:!0})}removeListeners(){const e=this.images.length;for(let t=0;t<e;t++)this.images[t].removeEventListener("pointerenter",this.animateInDispFactorCallback,{passive:!0}),this.images[t].removeEventListener("pointerleave",this.animateOutDispFactorCallback,{passive:!0})}setFisheye(){BABYLON.Effect.ShadersStore.fisheyeFragmentShader="\n       precision highp float;\n  \n       varying vec2 vUV;\n  \n       uniform sampler2D textureSampler;\n       uniform vec2 u_resolution;\n       uniform float u_distortion;\n  \n       // Forum post: http://www.html5gamedevs.com/topic/29295-fish-eye-and-reverse-fish-eye/?do=findComment&comment=168839\n       // Playground: https://www.babylonjs-playground.com/#TRNYD#20\n       void main() {\n         vec2 uv = (gl_FragCoord.xy / u_resolution.xy) - vec2(0.5);\n         float uva = atan(uv.x, uv.y);\n         float uvd = sqrt(dot(uv, uv));\n         float k = sin(u_distortion);\n         uvd *= 1.0 + k*uvd*uvd;\n  \n         gl_FragColor = texture(textureSampler, vec2(0.5) + vec2(sin(uva), cos(uva))*uvd);\n  \n         // vec3 color = texture2D(textureSampler, vUV).xyz;\n         // gl_FragColor = vec4(color, 1.0);\n       }\n      ",this.fisheyePP=new BABYLON.PostProcess("fisheye","fisheye",["u_resolution","u_distortion"],null,1,this.camera,0,this.engine),this.fisheyePP.onApply=(e=>{e.setFloat2("u_resolution",this.fisheyePP.width,this.fisheyePP.height)}),this.fisheyePP.onBeforeRenderObservable.add(e=>e.setFloat("u_distortion",this.fisheyeDistortion.value))}destroy(){this.removeListeners(),this.engine.dispose()}}const t=new e({images:[...document.querySelectorAll(".js-webgl-image")]});imagesLoaded("#wrapper",()=>{document.querySelector(".load-screen").classList.add("hidden"),t.init();tornis.watchViewport(({size:e,scroll:i})=>{e.changed&&(t.engine.resize(),t.setElementsBounds(),t.setElementsStyle(),t.setElementsPosition()),i.changed&&(t.animateFisheye({value:i.velocity.y}),t.setElementsPosition())})})}